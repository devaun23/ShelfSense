{% extends "base.html" %}

{% block title %}Your Weekly ShelfSense Progress{% endblock %}

{% block header %}Weekly Progress Report{% endblock %}

{% block content %}
<h2 style="color: #1a1a1a; margin: 0 0 20px; font-size: 22px;">
    Hi {{ first_name }},
</h2>

<p style="color: #4a4a4a; margin: 0 0 25px; font-size: 16px;">
    Here's your study progress for the week of {{ week_start }} - {{ week_end }}.
</p>

<!-- Stats Cards -->
<table role="presentation" style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
    <tr>
        <!-- Questions Answered -->
        <td style="width: 50%; padding: 15px; background: #f8f9fa; border-radius: 8px 0 0 8px; text-align: center; border-right: 1px solid #e9ecef;">
            <div style="font-size: 32px; font-weight: 700; color: #667eea;">{{ questions_answered }}</div>
            <div style="font-size: 14px; color: #6c757d;">Questions Answered</div>
        </td>
        <!-- Accuracy -->
        <td style="width: 50%; padding: 15px; background: #f8f9fa; border-radius: 0 8px 8px 0; text-align: center;">
            <div style="font-size: 32px; font-weight: 700; color: {% if accuracy >= 70 %}#28a745{% elif accuracy >= 50 %}#ffc107{% else %}#dc3545{% endif %};">{{ accuracy }}%</div>
            <div style="font-size: 14px; color: #6c757d;">Weekly Accuracy</div>
        </td>
    </tr>
</table>

<!-- Streak Status -->
<table role="presentation" style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
    <tr>
        <td style="padding: 20px; background: linear-gradient(135deg, #ff9a56 0%, #ff6b35 100%); border-radius: 8px; text-align: center;">
            <div style="font-size: 28px; margin-bottom: 5px;">üî•</div>
            <div style="font-size: 24px; font-weight: 700; color: #ffffff;">{{ current_streak }} Day Streak</div>
            {% if streak_at_risk %}
            <div style="font-size: 14px; color: #fff3cd; margin-top: 5px;">Don't lose it - study today!</div>
            {% else %}
            <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-top: 5px;">Personal Best: {{ best_streak }} days</div>
            {% endif %}
        </td>
    </tr>
</table>

<!-- Score Prediction -->
{% if predicted_score %}
<table role="presentation" style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
    <tr>
        <td style="padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: center; border: 1px solid #e9ecef;">
            <div style="font-size: 14px; color: #6c757d; margin-bottom: 5px;">Predicted Step 2 CK Score</div>
            <div style="font-size: 36px; font-weight: 700; color: #667eea;">{{ predicted_score }}</div>
            {% if score_change %}
            <div style="font-size: 14px; color: {% if score_change > 0 %}#28a745{% else %}#dc3545{% endif %}; margin-top: 5px;">
                {% if score_change > 0 %}‚Üë{% else %}‚Üì{% endif %} {{ score_change|abs }} from last week
            </div>
            {% endif %}
        </td>
    </tr>
</table>
{% endif %}

<!-- Weak Areas -->
{% if weak_areas %}
<div style="margin-bottom: 30px;">
    <h3 style="color: #1a1a1a; margin: 0 0 15px; font-size: 18px;">üìö Focus Areas This Week</h3>
    <p style="color: #6c757d; margin: 0 0 15px; font-size: 14px;">
        These topics need more practice:
    </p>
    <table role="presentation" style="width: 100%; border-collapse: collapse;">
        {% for area in weak_areas[:3] %}
        <tr>
            <td style="padding: 12px; background: {% if loop.index % 2 == 0 %}#ffffff{% else %}#f8f9fa{% endif %}; border-bottom: 1px solid #e9ecef;">
                <div style="font-size: 15px; color: #1a1a1a; font-weight: 500;">{{ area.name }}</div>
                <div style="font-size: 13px; color: #6c757d;">{{ area.accuracy }}% accuracy ({{ area.attempts }} questions)</div>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

<!-- Reviews Due -->
{% if reviews_due > 0 %}
<div style="margin-bottom: 30px; padding: 20px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107;">
    <div style="font-size: 16px; color: #856404;">
        <strong>‚è∞ {{ reviews_due }} reviews are due!</strong>
        <p style="margin: 10px 0 0; font-size: 14px;">Don't let your spaced repetition fall behind.</p>
    </div>
</div>
{% endif %}

<!-- CTA Button -->
<table role="presentation" style="width: 100%; border-collapse: collapse; margin-bottom: 25px;">
    <tr>
        <td align="center" style="padding: 20px 0;">
            <a href="{{ study_url }}" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600; font-size: 16px;">
                Continue Studying ‚Üí
            </a>
        </td>
    </tr>
</table>

<p style="color: #6c757d; margin: 0; font-size: 14px; text-align: center;">
    Keep up the great work! Consistency is key to USMLE success.
</p>
{% endblock %}
